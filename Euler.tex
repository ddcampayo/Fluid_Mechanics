\section{Material derivative}

When deriving our equations, it is important to distinguish between
a partial time variation and the total one. This is mathematically
encapsulated in the expression for the total variation of a function
of three Cartesian coordinates plus time:
\[
\frac{d A(x,y,z,t) }{dt} =
\frac{\partial A }{\partial t} +
\frac{\partial A }{\partial x} \frac{dx }{dt} +
\frac{\partial A }{\partial y} \frac{dy }{dt} +
\frac{\partial A }{\partial z} \frac{dz }{dt} .
\]


The Cartesian components are not to be considered as independent of
the time. Rather, their time derivatives are precisely the components
of the velocity field:
\[
\frac{d A(x,y,z,t) }{dt} =
\frac{\partial A }{\partial t} +
\frac{\partial A }{\partial x} u_x +
\frac{\partial A }{\partial y} u_y +
\frac{\partial A }{\partial z} u_z .
\]

A way to write this expression more concisely is
\[
\frac{d A }{dt} =
\frac{\partial A }{\partial t} +
\bfu \cdot \nabla A ,
\]
where the operator $\bfu \cdot \nabla$ is
\[
\bfu \cdot \nabla  =
\sum_i u_i \frac{\partial  }{\partial x_i} ,
\]
which indeed looks like a scalar product of vector $\bfu$ and the
vector operator $\nabla$.

This total time derivative received very many names. Among the most
popular we find ``material'', ``Eulerian'', ``convective'',
``advective'' \index{material derivative} \ldots

In any case, the consequence is that convection by the velocity field
adds a new term. This has an important consequence for the change
of the velocity field itself, which turns out to be non-linear. Indeed,
for component $i$,
\[
\frac{d u_i }{dt} =
\frac{\partial v_i }{\partial t} +
\bfu \cdot \nabla u_i .
\]
The second, non-linear term is called the convective
acceleration\index{convective acceleration}. When expressing this
equality in vector form, it is important not to make the eror of
writing
\[
\frac{d \bfu  }{dt} =
\frac{\partial \bfu }{\partial t} +
\bfu  ( \nabla \cdot \bfu ) \qquad \text{(wrong!)} ,
\]
which would imply that incompressible fluids have no such extra
acceleration. The correct expression is
\[
\frac{d \bfu  }{dt} =
\frac{\partial \bfu }{\partial t} +
(\bfu \cdot  \nabla ) \bfu  \qquad \text{(right)} .
\]

Another concise, but more obscure, way of writing it is
\[
\frac{d \bfu  }{dt} =
\frac{\partial \bfu }{\partial t} +
\bfu \cdot  ( \nabla  \bfu ) ,
\]
where now $\nabla  \bfu$ is to be interpreted as a tensor, with
components
\begin{equation}
  \label{eq:nabla_u_def}
  (\nabla  \bfu)_{ij} = \frac{\partial u_j}{\partial x_i} ,
\end{equation}
i.e. a direct product of the vector operator $\nabla$ and vector
$\bfu$ (also known as ``the gradient of vector $\bfu$.'') The
operation $\bfu \cdot ( \nabla \bfu )$ is then similar to a left
multiplication of a matrix by a row vector, resulting in a column
vector. This sort of tensors will be again considered in Section
\ref{sec:particle}.  Given these two possible interpretations, the
acceleration is often written without any parentheses:
\[
\frac{d \bfu  }{dt} =
\frac{\partial \bfu }{\partial t} +
\bfu \cdot  \nabla  \bfu .
\]


Yet another expression involves the direct product of the velocity
vector with itself:
\[
( \bfu \otimes \bfu )_{ij} := u_i u_j ,
\]
which lets us write
\begin{equation}
  \label{eq:Euler_uu}
    \frac{d \bfu  }{dt} =
    \frac{\partial \bfu }{\partial t} +
    \nabla \cdot ( \bfu \otimes \bfu ),  
\end{equation}
as may be easily checked. This last expression is useful to write down
so-called ``conservation form'' of the equations, in which one desires
an overall $\nabla$ operator acting on several expressions.


\subsection{Continuity, revisited}
\label{sec:continuity2}

The continuity equation, Eq. \ref{eq:continuity} may be written as
\[
\frac{\partial \rho }{\partial t} +
\rho \nabla \cdot \bfu +
(\bfu \cdot \nabla) \rho = 0 ,
\]
or
%
\begin{equation}
  \label{eq:convergence}
  \frac{d \rho }{d t} = 
  - \rho \nabla  \cdot \bfu .
\end{equation}
This expression is called the ``convergence equation'' by Joe
Monaghan: if $\nabla \cdot \bfu $ is the divergence,
$ - \nabla \cdot \bfu $ could be called the convergence.

We now see that incompressibility, defined as $\nabla \cdot \bfu = 0
$, implies $d(\rho)/(dt) = 0$. This means that density is ``carried
with the flow'', as explained in next session.

\subsection{Physical meaning of the material derivative}

If we measure the value of a given field at a fixed point in space,
its plot as a function of time has a first derivative which, by
definition, is the partial time derivative. If however, we measure
its value as we move along with the flow, we will obtain its total
derivative.

A common example considers temperature, partly because this is a
quantity that humans can readily ``feel'', and which is routinely
measured with thermometers. Imagine a thermometer probe inserted at
some point along a stream. Its reading are approximately constant
since the flow is steady. If a gate is opened upstream at the bottom
of a reservoir, colder water will move downstream, and our temperature
readings will drop.

Imagine instead a thermometer inserted through a cork flowing with the
flow. If a thermometer is released upstream, close to the reservoir,
its readings will change little. This is true for the case before the
gate opening, and for the case after the gate. In the later case, the
reading will be lower, but constantly so. This later reading is
approximately the total derivative $dT/dt$, while the previous is the
partial $\partial T / \partial t$.

Notice that we may have $dT/dt = 0$ even if $\partial T / \partial t
\ne 0$, if
\[
\frac{\partial T }{ \partial t} = - \bfu \cdot \nabla T
\qquad\implies\qquad
\frac{d T }{d t} = 0 .
\]
The first equation precisely describes the situation in which a change
in the local value of $T$ is due only to convection. This is the
case that closely resembles the reservour release experiment.

Equivalently, we may have $\partial T / \partial t = 0$, but $dT/dt
\ne 0$:
\[
\frac{d T }{d t} = \bfu \cdot \nabla T
\qquad\implies\qquad
\frac{\partial T }{\partial t} = 0 ,
\]
which expresses the fact that a particle moving with the flow may
experience changes in temperature even if this field is locally
constant. This may apply to a flow in which a temperature gradient is
established, from a cold region to a hotter one. Fluid going from one
to the other will register this change in temperature even if
locally the variation is null.

We stress that this discussion applies to any field, even if they
are vector fields
(since it applies to each of its components, which are scalar).

In a sense, the total derivative is the ``right one'' physically. Since
Newton's equations of motion apply to fluid particles (and not fixed volume particles),
it is the total derivative of the velocity that should be equated with the force (per mass),
as will be discussed in Section \ref{sec:momentum_eq}.


\subsection{The steady state}

If the state of the flow is \emph{steady} this means that
all fields do not change with time when evaluated at a given
point --- but, they may still change in space. Mathematically.
\begin{equation*}
\frac{\partial A}{\partial t} = 0
\end{equation*}
for all $A$ field (including vector fields, through e.g. their
Cartesian components).

In particular, the velocity field will be fixed in time. The paths
in space traced by the velocity field are called streamlines.
Intuitively, one starts at some point and moves following the
velocity field, thus tracing a streamline. Numerically, this is
in essence what is computed by CFD software. Mathematically, the
equation will be
\begin{equation*}
\frac{d \bfr}{\partial s} = \bfu( \bff(s) ) ,
\end{equation*}
where we use $s$ instead of $t$ to stress the fact that the
parameter in this ``trajectory'' is \emph{not} the physical time,
and is only used to trace the line.

It is instructive to consider mass continuity in this case.
It reduces to
\begin{equation*}
\nabla \cdot (\rho \bfu ) =   
\rho \nabla \cdot \bfu + \bfu   \cdot \nabla \rho  = 0 .
\end{equation*}

If the velocity field is, moreover, divergence-free,
\begin{equation*}
 \bfu   \cdot \nabla \rho  = 0 .
\end{equation*}
Now, the gradient of a field is a vector field perpendicular to
its iso-contours (the contours at which the field has constant
values). Since the gradient of the density is perpendicular to
the velocity, this equation tell us that the density is
\emph{constant} along streamlines. This applies not only
to the density, but to any conserved quantity. See Exercise
\ref{ex:2D_dens_for_u} for a concrete simple case.

\section{External and pressure forces}
\label{sec:pressure_forces}

Let us discuss possible forces acting upon a particle. They may be
split into volume, or external, or surface. The first one includes all
forces that are due to field that act upon the material of the
particle as a whole. The most common ones are gravitational, and
electromagnetic. We will not consider the latter ones for
simplicity. Its study defines magnetohydrodynamics, and is relevant
and interesting, but beyond the scope of these notes. We are left with
gravity. If the scale of our problem is within some kilometers around
the surface of the Earth, the force of gravity is constant and equal
to $dm \bfg$, where $\bfg$ is a gravitational acceleration
vector. This vector points ``down'' (usually, the $-z$ or $-y$
direction, depending on our convention), and has a magnitude
$g=\SI{9.8}{\meter\per\second\square}$. Its effect is given by
Newton's Second law, according to which the net force on a particle
with mass $dm$ is
\[
\bfF_\text{ext} = dm \bfg ,
\]
causing a volumetric force
\[
\bff_\text{ext} = \frac{\bfF_\text{ext}}{dV}= \rho \bfg .
\]

Surface forces may in turn may split into compression and stress
forces. The latter are absent in an ideal fluid by definition, and we
are left only with compression. This effect is caused by the best
known surface force field: the pressure. Indeed, a pressure on the
left wall of the particle will cause a horizontal force
\begin{equation}
  \label{eq:pressure_force_on_left}
  \left. F_{p,x} \right|_\text{l} =
  p  dy\, dz .
\end{equation}
The net force is the pressure times the area, $dy\,dz$, and there is a
minus sign because by definition pressure acts from outside to the
inside. The total horizontal force will also have an influence from the
right wall, which has a pressure $p'$ that may be different from $p$:
\[
F_{p,x} =  (p - p')  dy\, dz .
\]
Notice that the force is null if the pressure is equal. Also, thanks
to our sign convention, if $p'<p$ we get a net horizontal force, which
is in agreement with the concept of a pressure drop causing a force in
the direction in which density is lower. Now, expanding in Taylor
series,
\[
p' \approx p + \frac{\partial p }{ \partial x} dx ,
\]
so
\[
F_{p,x} =
-  \frac{\partial p }{ \partial x}  dx\, dy\, dz =
-  \frac{\partial p }{ \partial x}  dV .
\]
I.e., the volumetric force in the horizontal direction will be
\[
f_{p,x} = -  \frac{\partial p }{ \partial x} .
\]

Similar expressions will result for the $y$ and $z$ directions. All
three may be encapsulated in vector form:
\[
\bff_p = - \nabla p .
\]
I.e. the volumetric pressure force is minus the gradient of the
pressure.

The total volumetric force is then
\[
\bff =  - \nabla p + \rho \bfg .
\]

\section{The momentum equation}
\label{sec:momentum_eq}

A bold and quick way to reach Euler's momentum equation is to equate
mass times acceleration with forces, in the spirit of Newton's Second
law:
\[
dm \frac{d\bfu}{dt} = V \bff .
\]
Dividing by the volume,
\[
\rho \frac{d\bfu}{dt} = \bff .
\]
This is in fact correct, and leads to
\begin{equation}
  \label{eq:Euler_momentum}
  \rho \frac{d\bfu }{dt} = - \nabla p + \rho \bfg .
\end{equation}
In Cartesian components, the equation reads
\begin{equation}
  \label{eq:Euler_momentum_C}
  \rho \frac{d u_i }{dt} =
  - \frac{\partial p} {\partial x_i} 
  + \rho g_i .
\end{equation}

Notice, however that the derivation involves supposing that $dm$ may
be taken out of the time derivative. This is because the mass of a
moving particle does not change --- in Section \ref{sec:continuity3}
we will see how this fact takes us to the correct continuity equation.

\subsection{Conservation form}

It is well known that Newton's second law applied to mass times
acceleration, or equivalently, to the variation of linear momentum
(since the mass of a particle does not change). The reader may be
therefore worried about this law being the right one.  In fact, a
direct application of the ideas in Section \ref{sec:continuity} would
lead to this sort of equation for the change in the $i$-th component
of the linear momentum:
\[
\frac{\partial (\rho u_i) } {\partial t} =
- \nabla \cdot  ( \rho u_i \bfu )
- \frac{\partial p} {\partial x_i} 
  + \rho g_i .
\]
In it, the change of linear momentum per volume is changed due to
volumetric forces, and also due to convection of momentum.


This can
also be written in vector form:
\[
\frac{\partial  (\rho \bfu ) }{\partial t} +
\nabla \cdot ( \rho \bfu \otimes \bfu ) =
  - \nabla p 
  + \rho \bfg ,
\]
which strongly resembles the expression of \ref{eq:Euler_uu}. The
difference is that now the density $\rho$ is inside the time and
space derivatives.

The happy answer is that both are equivalent, thanks to this handy
identity, which applies to any field:
\[
\frac{\partial ( \rho  A ) }{\partial t} +
\nabla  \cdot ( \rho \bfu A) =
%
A
\underbrace{
\left(
\frac{\partial \rho }{\partial t} +
\nabla  \cdot ( \rho \bfu ) 
\right)}_{=0}  +
\rho 
\underbrace{
\left(
\frac{\partial A }{\partial t} +
\bfu \cdot \nabla  A
\right) }_{=dA/dt}  ,
\]
or
\begin{equation}
  \label{eq:conserv_to_total}
  \frac{\partial ( \rho  A ) }{\partial t} +
  \nabla  \cdot ( \rho \bfu A) =
  \rho \frac{d  A }{d t} .
\end{equation}
This identity permits the conversion from the ``conservation''
expression of any quantity $\rho A$ as a ``convective form'', $\rho
dA/dt$. It is interesting that if $A$ is a constant, continity is
recovered.

Since this identity applies to each of the Cartesian components of the
velocity, then it applies to the velocity itself.

We may therefore write Euler's equation in conservation form:
\[
\frac{\partial  (\rho \bfu ) }{\partial t} +
 \nabla \cdot ( \rho \bfu \otimes \bfu ) =
 - \nabla p 
 + \rho \bfg .
\]



